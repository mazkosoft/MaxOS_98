<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Windows 98</title>
    <link rel="icon" href="https://win98icons.alexmeub.com/icons/png/computer-3.png" type="image/png">
    <style>
        /* 引入 98.css */
        @import url("https://unpkg.com/98.css");

        body, html {
            height: 100%;
            margin: 0;
            overflow: hidden;
            font-family: "Pixelated MS Sans Serif", "Tahoma", "Arial", sans-serif;
            background-color: #008080; /* Windows 98 经典桌面背景色 */
        }

        #desktop {
            height: calc(100% - 28px);
            position: relative;
            display: flex;
            flex-direction: column;
            flex-wrap: wrap;
            align-content: flex-start;
            padding: 4px;
        }

        .desktop-icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            width: 80px;
            margin: 10px;
            cursor: pointer;
            padding: 5px;
            border: 1px solid transparent;
        }

        .desktop-icon:focus {
            background-color: #000080;
            color: white;
            border: 1px dotted white;
            outline: none;
        }
        
        .desktop-icon:focus img {
            filter: invert(100%) sepia(100%) saturate(0%) hue-rotate(180deg) brightness(100%) contrast(100%);
        }

        .desktop-icon img {
            width: 32px;
            height: 32px;
            margin-bottom: 5px;
        }

        .desktop-icon span {
            color: white;
            font-size: 12px;
            text-shadow: 1px 1px 2px black;
        }

        /* 任务栏 */
        .taskbar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 28px;
            background-color: #c0c0c0;
            border-top: 2px solid #ffffff;
            display: flex;
            align-items: center;
            padding: 0 2px;
            z-index: 10000;
        }

        .start-button {
            font-weight: bold;
            display: flex;
            align-items: center;
            padding: 2px 6px;
        }
        
        .start-button img {
            width: 16px;
            height: 16px;
            margin-right: 4px;
        }

        .taskbar-items {
            flex-grow: 1;
            display: flex;
            height: 100%;
            align-items: center;
            margin-left: 4px;
        }

        .taskbar-item {
            display: flex;
            align-items: center;
            height: 22px;
            padding: 0 6px;
            margin-right: 2px;
            max-width: 150px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .taskbar-item.active {
            font-weight: bold;
            box-shadow: inset 1px 1px #000, inset -1px -1px #fff;
            background: repeating-conic-gradient(#808080 0% 25%, #c0c0c0 0% 50%) 50% / 2px 2px;
        }
        
        .taskbar-item img {
            width: 16px;
            height: 16px;
            margin-right: 4px;
        }

        .clock {
            padding: 0 6px;
            height: 22px;
            line-height: 22px;
            margin-left: auto;
            border: 1px solid #808080;
            border-right-color: #fff;
            border-bottom-color: #fff;
            box-shadow: inset 1px 1px #dfdfdf, 1px 0 #000;
            margin-right: 2px;
        }

        /* 开始菜单 */
        #start-menu {
            position: absolute;
            bottom: 28px;
            left: 0;
            width: 180px;
            background-color: #c0c0c0;
            border: 2px solid;
            border-top-color: #fff;
            border-left-color: #fff;
            border-right-color: #000;
            border-bottom-color: #000;
            padding: 2px;
            display: none; /* 默认隐藏 */
            z-index: 9999;
        }
        
        #start-menu-sidebar {
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 24px;
            background: #808080;
            color: #c0c0c0;
            writing-mode: vertical-lr;
            text-orientation: upright;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            font-size: 18px;
            font-weight: bold;
            padding-right: 2px;
        }
        
        #start-menu-sidebar span {
            color: white;
            margin-left: -4px;
        }

        .start-menu-list {
            list-style: none;
            margin: 0;
            padding: 0;
            margin-left: 26px; /* 为侧边栏留出空间 */
        }
        
        .start-menu-list li {
            padding: 5px 10px 5px 20px;
            display: flex;
            align-items: center;
        }

        .start-menu-list li:hover {
            background-color: #000080;
            color: white;
        }
        
        .start-menu-list img {
            width: 24px;
            height: 24px;
            margin-right: 8px;
        }
        
        .start-menu-separator {
            height: 1px;
            background-color: #808080;
            border-bottom: 1px solid #fff;
            margin: 4px 0;
        }
        
        /* 窗口自定义样式 */
        .window {
            position: absolute;
            min-width: 200px;
            min-height: 150px;
            box-shadow: 2px 2px 10px rgba(0,0,0,0.5);
        }
        
        .window .title-bar {
            cursor: move;
        }
        
        .window-content {
            padding: 10px;
            background: white;
            height: calc(100% - 40px);
            overflow: auto;
        }
        
        /* 记事本 */
        #notepad-textarea {
            width: 100%;
            height: 100%;
            border: none;
            resize: none;
            outline: none;
            font-family: 'Lucida Console', 'Courier New', monospace;
            font-size: 14px;
        }
        
        /* 扫雷 */
        .minesweeper-grid {
            display: grid;
            grid-template-columns: repeat(10, 20px);
            grid-template-rows: repeat(10, 20px);
            border: 2px solid;
            border-top-color: #808080;
            border-left-color: #808080;
            border-right-color: #fff;
            border-bottom-color: #fff;
        }
        .mine-cell {
            width: 20px;
            height: 20px;
            background-color: #c0c0c0;
            border: 2px solid;
            border-top-color: #fff;
            border-left-color: #fff;
            border-right-color: #808080;
            border-bottom-color: #808080;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-family: monospace;
            font-size: 14px;
        }
        .mine-cell.revealed {
            border: 1px solid #808080;
        }

    </style>
</head>
<body>

<div id="desktop">
    <div class="desktop-icon" tabindex="0" data-app="my-computer">
        <img src="https://win98icons.alexmeub.com/icons/png/computer-3.png" alt="My Computer">
        <span>我的电脑</span>
    </div>
    <div class="desktop-icon" tabindex="0" data-app="notepad">
        <img src="https://win98icons.alexmeub.com/icons/png/notepad-1.png" alt="Notepad">
        <span>记事本</span>
    </div>
    <div class="desktop-icon" tabindex="0" data-app="minesweeper">
        <img src="https://win98icons.alexmeub.com/icons/png/minesweeper-0.png" alt="Minesweeper">
        <span>扫雷</span>
    </div>
</div>

<div id="start-menu">
    <div id="start-menu-sidebar">
        <span>Windows</span><span>98</span>
    </div>
    <ul class="start-menu-list">
        <li data-app="notepad">
            <img src="https://win98icons.alexmeub.com/icons/png/notepad-2.png" alt="Notepad">
            程序
        </li>
        <li>
            <img src="https://win98icons.alexmeub.com/icons/png/documents-0.png" alt="Documents">
            文档
        </li>
        <li>
            <img src="https://win98icons.alexmeub.com/icons/png/settings-1.png" alt="Settings">
            设置
        </li>
        <li>
            <img src="https://win98icons.alexmeub.com/icons/png/search_file-2.png" alt="Find">
            查找
        </li>
        <li class="start-menu-separator"></li>
        <li id="shutdown-btn">
            <img src="https://win98icons.alexmeub.com/icons/png/shut_down-3.png" alt="Shut Down">
            关闭系统...
        </li>
    </ul>
</div>

<div class="taskbar">
    <button class="start-button" id="start-btn">
        <img src="https://win98icons.alexmeub.com/icons/png/windows-0.png" alt="Start">
        Start
    </button>
    <div class="sunken-panel" style="width: 2px; height: 22px; margin: 0 2px;"></div>
    <div class="taskbar-items" id="taskbar-items"></div>
    <div class="clock" id="clock">12:00 PM</div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const desktop = document.getElementById('desktop');
    const taskbarItems = document.getElementById('taskbar-items');
    const startBtn = document.getElementById('start-btn');
    const startMenu = document.getElementById('start-menu');
    const clock = document.getElementById('clock');
    
    let activeWindow = null;
    let highestZIndex = 100;
    const openWindows = {};

    // --- 时钟功能 ---
    function updateClock() {
        const now = new Date();
        const hours = now.getHours();
        const minutes = now.getMinutes();
        const ampm = hours >= 12 ? 'PM' : 'AM';
        const formattedHours = hours % 12 || 12;
        const formattedMinutes = minutes < 10 ? '0' + minutes : minutes;
        clock.textContent = `${formattedHours}:${formattedMinutes} ${ampm}`;
    }
    setInterval(updateClock, 1000);
    updateClock();

    // --- 开始菜单 ---
    startBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        startMenu.style.display = startMenu.style.display === 'block' ? 'none' : 'block';
        startBtn.classList.toggle('active');
    });

    document.addEventListener('click', () => {
        startMenu.style.display = 'none';
        startBtn.classList.remove('active');
    });

    startMenu.addEventListener('click', (e) => e.stopPropagation());
    
    // --- 窗口管理器 ---
    class WindowManager {
        constructor(id, title, icon, content, width = 400, height = 300, x = 50, y = 50) {
            if (openWindows[id]) {
                openWindows[id].focus();
                return;
            }

            this.id = id;
            this.title = title;
            this.icon = icon;
            this.width = width;
            this.height = height;
            this.x = x + Object.keys(openWindows).length * 20;
            this.y = y + Object.keys(openWindows).length * 20;
            
            this.minimized = false;

            this.createWindow(content);
            this.createTaskbarItem();
            this.focus();
            
            openWindows[id] = this;
        }

        createWindow(content) {
            this.win = document.createElement('div');
            this.win.className = 'window';
            this.win.style.width = `${this.width}px`;
            this.win.style.height = `${this.height}px`;
            this.win.style.left = `${this.x}px`;
            this.win.style.top = `${this.y}px`;

            this.win.innerHTML = `
                <div class="title-bar">
                    <div class="title-bar-text">${this.title}</div>
                    <div class="title-bar-controls">
                        <button aria-label="Minimize"></button>
                        <button aria-label="Maximize"></button>
                        <button aria-label="Close"></button>
                    </div>
                </div>
                <div class="window-body" style="padding: 0; margin: 0; height: calc(100% - 21px); display: flex; flex-direction: column;">
                    ${content}
                </div>
            `;
            desktop.appendChild(this.win);
            
            this.titleBar = this.win.querySelector('.title-bar');
            this.closeBtn = this.win.querySelector('[aria-label="Close"]');
            this.minimizeBtn = this.win.querySelector('[aria-label="Minimize"]');
            this.maximizeBtn = this.win.querySelector('[aria-label="Maximize"]');
            
            this.addEventListeners();
        }
        
        createTaskbarItem() {
            this.taskbarItem = document.createElement('button');
            this.taskbarItem.className = 'taskbar-item';
            this.taskbarItem.innerHTML = `<img src="${this.icon}" alt="${this.title}"> ${this.title}`;
            taskbarItems.appendChild(this.taskbarItem);
            
            this.taskbarItem.addEventListener('click', () => {
                if (this.minimized) {
                    this.restore();
                } else if (this.win === activeWindow) {
                    this.minimize();
                } else {
                    this.focus();
                }
            });
        }

        addEventListeners() {
            this.closeBtn.addEventListener('click', () => this.close());
            this.minimizeBtn.addEventListener('click', () => this.minimize());
            this.maximizeBtn.addEventListener('click', () => this.toggleMaximize());
            
            this.win.addEventListener('mousedown', () => this.focus());
            
            // 拖动逻辑
            let isDragging = false;
            let dragOffsetX, dragOffsetY;
            this.titleBar.addEventListener('mousedown', (e) => {
                isDragging = true;
                dragOffsetX = e.clientX - this.win.offsetLeft;
                dragOffsetY = e.clientY - this.win.offsetTop;
                this.win.style.userSelect = 'none';
            });
            document.addEventListener('mousemove', (e) => {
                if (isDragging) {
                    this.win.style.left = `${e.clientX - dragOffsetX}px`;
                    this.win.style.top = `${e.clientY - dragOffsetY}px`;
                }
            });
            document.addEventListener('mouseup', () => {
                isDragging = false;
                this.win.style.userSelect = '';
            });
        }
        
        focus() {
            if (activeWindow) {
                activeWindow.blur();
            }
            activeWindow = this;
            this.win.style.zIndex = ++highestZIndex;
            this.taskbarItem.classList.add('active');
            this.win.querySelector('.title-bar').classList.add('active');
            this.minimized = false;
            this.win.style.display = 'block';
        }
        
        blur() {
            this.taskbarItem.classList.remove('active');
            this.win.querySelector('.title-bar').classList.remove('active');
        }

        close() {
            desktop.removeChild(this.win);
            taskbarItems.removeChild(this.taskbarItem);
            delete openWindows[this.id];
            if (activeWindow === this) {
                activeWindow = null;
            }
        }
        
        minimize() {
            this.win.style.display = 'none';
            this.minimized = true;
            this.blur();
            activeWindow = null;
        }
        
        restore() {
            this.win.style.display = 'block';
            this.minimized = false;
            this.focus();
        }
        
        toggleMaximize() {
            if (this.isMaximized) {
                this.win.style.width = this.prevWidth;
                this.win.style.height = this.prevHeight;
                this.win.style.left = this.prevLeft;
                this.win.style.top = this.prevTop;
                this.isMaximized = false;
            } else {
                this.prevWidth = this.win.style.width;
                this.prevHeight = this.win.style.height;
                this.prevLeft = this.win.style.left;
                this.prevTop = this.win.style.top;
                
                this.win.style.width = '100%';
                this.win.style.height = `calc(100% - ${28}px)`;
                this.win.style.left = '0';
                this.win.style.top = '0';
                this.isMaximized = true;
            }
        }
    }

    // --- 应用程序定义 ---
    const appDefinitions = {
        'my-computer': {
            title: '我的电脑',
            icon: 'https://win98icons.alexmeub.com/icons/png/computer-3.png',
            content: `
                <div class="window-content" style="background: white;">
                    <p> (C:) </p>
                    <p> (D:) </p>
                    <p> 控制面板 </p>
                </div>
            `,
            width: 300,
            height: 250
        },
        'notepad': {
            title: '无标题 - 记事本',
            icon: 'https://win98icons.alexmeub.com/icons/png/notepad-1.png',
            content: `
                <div class="status-bar" style="height:20px; font-size:12px; padding-left:2px;">
                    <p class="status-bar-field">文件</p>
                    <p class="status-bar-field">编辑</p>
                    <p class="status-bar-field">帮助</p>
                </div>
                <textarea id="notepad-textarea"></textarea>
            `,
            width: 500,
            height: 400
        },
        'minesweeper': {
            title: '扫雷',
            icon: 'https://win98icons.alexmeub.com/icons/png/minesweeper-0.png',
            content: `
                 <div class="window-content" style="display:flex; flex-direction:column; align-items:center; background: #c0c0c0; padding: 10px;">
                    <div style="display:flex; justify-content:space-between; width:100%; margin-bottom:10px; padding:5px; border: 2px inset #c0c0c0;">
                        <div class="sunken-panel" style="padding:2px 5px; font-family:monospace; color:red; font-size:18px;">010</div>
                        <button>🙂</button>
                        <div class="sunken-panel" style="padding:2px 5px; font-family:monospace; color:red; font-size:18px;">000</div>
                    </div>
                    <div class="minesweeper-grid">
                        ${Array(100).fill('<div class="mine-cell"></div>').join('')}
                    </div>
                </div>
            `,
            width: 250,
            height: 350
        }
    };
    
    function openApp(appId) {
        const app = appDefinitions[appId];
        if (app) {
            new WindowManager(appId, app.title, app.icon, app.content, app.width, app.height);
        }
        startMenu.style.display = 'none';
        startBtn.classList.remove('active');
    }

    // --- 桌面图标和开始菜单的事件绑定 ---
    document.querySelectorAll('[data-app]').forEach(el => {
        el.addEventListener('dblclick', () => openApp(el.dataset.app));
        el.addEventListener('click', (e) => {
            if (e.currentTarget.parentElement.id === 'start-menu-list') {
                openApp(el.dataset.app)
            }
        });
    });

    // 关机按钮
    document.getElementById('shutdown-btn').addEventListener('click', () => {
        alert('现在可以安全地关闭计算机了。');
    });
});
</script>

</body>
</html>
